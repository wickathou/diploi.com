---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import { MinusIcon, PlugsConnectedIcon, PlugsIcon, TerminalWindowIcon } from '@phosphor-icons/react';
import Link from '../../../../components/Link.astro';
import Tag from '../../../../components/Tag.astro';
import cursorLogo from '../../../../images/cursor-logo.webp';
import vscodeLogo from '../../../../images/vscode-logo.svg';
import FeaturesHr from '../../_components/FeaturesHr.astro';
import FeaturesSection from '../../_components/FeaturesSection.astro';
import FeaturesSectionHeader from '../../_components/FeaturesSectionHeader.astro';
import { createStackBackgroundUri } from '../../_components/featuresUtils';
import cursorPreview from '../_images/cursor.png';
import terminalPreview from '../_images/terminal.png';
import vscodePreview from '../_images/vscode.png';

const articles = await getCollection('blog');
const linkedFilterWords = [' ai ', 'remote development'];
const linkedArticles = articles
  .filter((article) => linkedFilterWords.some((word) => article.data.title.toLowerCase().includes(word)))
  .slice(0, 3);

const previewImageProps = {
  width: 340,
  quality: 'max',
};

const background = createStackBackgroundUri({
  size: 16,
  primary: 'rgba(255, 255, 255, 0.05)',
  secondary: 'rgba(255, 255, 255, 0.05)',
  chance: 0.1,
});
---

<FeaturesSection>
  <FeaturesSectionHeader slot="header">
    <PlugsIcon />
    <h2 id="editors">Use The Tools You Love</h2>
    <p>Diploi works with any IDE that supports SSH. We offer first-class support for the most popular AI-native editors.</p>
  </FeaturesSectionHeader>
  <div class="background" inert aria-hidden style={{ '--background': background }}></div>
  <section class="list">
    <article style={{ '--color-card-border': '#0098FF' }}>
      <Image {...previewImageProps} src={vscodePreview} alt="vs code preview" />
      <section>
        <Image width={32} height={32} src={vscodeLogo} alt="vs code logo" />
        <h3>VS Code <Tag primary>Officially supported</Tag></h3>
        <ul>
          <li><MinusIcon /> Copilot, agent mode</li>
          <li><MinusIcon /> Full extensions support</li>
        </ul>
      </section>
    </article>
    <FeaturesHr vertical />
    <article style={{ '--color-card-border': 'white' }}>
      <Image {...previewImageProps} src={cursorPreview} alt="cursor preview" />
      <section>
        <Image width={32} height={32} src={cursorLogo} alt="cursor logo" />
        <h3>Cursor <Tag primary>Officially supported</Tag></h3>
        <ul>
          <li><MinusIcon /> Agent mode, autocomplete, chat</li>
          <li><MinusIcon /> Full extensions support</li>
        </ul>
      </section>
    </article>
    <FeaturesHr vertical />
    <article>
      <Image {...previewImageProps} src={terminalPreview} alt="terminal preview" />
      <section>
        <TerminalWindowIcon size={32} />
        <h3>SSH <Tag primary>Officially supported</Tag></h3>
        <ul>
          <li><MinusIcon /> Full control over your environment</li>
          <li><MinusIcon /> Any Debian ARM package supported</li>
        </ul>
      </section>
    </article>
  </section>
  <div class="links">
    <FeaturesHr />
    <Link href="/dev">Remote development with Diploi</Link>
    {linkedArticles.map((article) => <Link href={`/blog/${article.data.slug}`}>{article.data.title}</Link>)}
  </div>
</FeaturesSection>

<style lang="scss">
  .list {
    display: flex;
    gap: 32px;

    @media (max-width: 860px) {
      flex-direction: column;
    }

    > article {
      flex: 1;

      > img {
        max-width: 100%;
      }

      > section {
        margin-top: 16px;

        :global(span) {
          transform: translateY(-2px);
        }

        > svg {
          color: var(--color-primary);
        }

        > ul > li {
          font-size: 1.25rem;
          font-weight: 350;
          color: var(--color-text-secondary);
        }
      }
    }
  }

  .links {
    display: flex;
    flex-direction: column;
    gap: 8px;

    :global(hr) {
      margin: 0;
      margin-bottom: 32px;
      max-width: 500px;
    }

    :global(a) {
      color: var(--color-text-secondary);
    }
  }

  .background {
    position: absolute;
    left: 0;
    width: 100%;
    height: 60vh;
    background-image: var(--background);
    background-size: 896px;
    overflow: hidden;
    z-index: -1;

    mask-image: linear-gradient(to bottom, transparent, white 50%, transparent);
  }
</style>
